# Базовая плата E3-2E Board
<img src="/MainBoard/photo_mainboard.jpg" width="1000">

На ней находиться esp32 с Ethernet портом, разводка по питанияю, и все вводы\выводы с esp. 
Плата максимально универсальная, с заделом под будущие модули. 

#### Почему esp32:
- двухядерный процессор, с частотой 240МГц
- Большое количество портов с ADC
- Сопроцессор с низким энергопотреблением
- 520 КБ памяти SRAM
- Wi-Fi: 802.11 b/g/N
- Порт Ethernet
- Bluetooth: v4.2 (в том числе BLE)
- [Прошивка EspHome](#прошивка-esphome)

<img src="/MainBoard/images/Board_1.png" width="600">

По сколько решение изначально щиточное, то от питания по 220 я отказался отказать в пользу 5-20v от внешних блоков питания. Которые при наличии светодиодного освещения и так будут там установлены. А так же это обусловлено тем, что блоки AС-DC на 5v, которые бы уместились на данную плату, как например HiLink, выдают всего 0.6а, чего не хватит для большинства шилдов. 
А для тех кто не планирует установаливать в щиток, питать можно плату питать от любого зарядника 1-2а через MicroUsb. 
На всякий случай есть защита по питания самовостанавливающимся предохранителем. 

#### Доступные порты ввода\вывода:
- 8 Портов с подключаемой внешней подтяжкой резисторм pulldown на 10к (3 их которых работаю только на вход)
- 1 Порт с подключаемо внешней подтяжкой pullup или pulldown на 10к
- 2 порта* на которые можно припаять вшнешний резистор (например для подключения светодиодных лент)
- I2c порт, для подключения внешних модулей, модулей второго уровня, , датчиков, экранов итд. В случае не надобности, превращаеться в обычные  2 порта ввода\вывода
Внешняя подтяжка нужна для подчлючения кнопок\бинарных датчков, на длянных проводах. К слову esp32 имеет внутренюю подтяжку, но на дальнных дистанциях она работает не совсем корректно. К примеру у меня на 20 метрах герконы работали не стабильно. 

*По поводу 2 портов. Один из них GPIO0, который имеет некоторые ограницения. Во первых (это специфика чипа esp32), он, при запуске платны будучи замкнутым на землю запускает режим прошивки, во вторых (а это - уже српецифика данной платы) его использовать можно только при покдлючении через wifi. Когда подключен Ethernet - увы. Порт занят.


Плату так же удобно использовать без дополнительных модулей, просто для удобства подключения внешних датчиков. 


<img src="/MainBoard/PCB.png" width="600">
Некоторые пояснения.

- P1 - Питание, вход. Слева на параво: +7-20v, GND, 5v. GND общий для подключение как 5v, так и 7-20v
- P2 - Выход, 5v, GND, 3.3v
- P3, P4, P5 - Входы\выходы с возможностью подключение внешней подтяжки резистором на 10к. 
- P6 - Порты ввода\вывода, с возможностью распайки резистора для защиты входа. Используеться например при подключении адресных светодиодных лент. Если резистор не нуден, паяеться просто перемычка. 
- I2c-Shield - для подключение дополнительных модулей вторым уровнем. 
- I2c - Для подключения внешних модулей, или датчиков. Если не планируете подключать модули второго уровня, то можно использовать как 2 порта ввода\вывода. 
- GPIO-Shield для модулей второго уровня. Используеться например на шилде с мосфетами. 
- Link - светодиод показываеющий статус подключение по Ethernet кабелю. 

Перейдем к сборке. 
### Схемотехника
<img src="/MainBoard/Schematic_E3-2e-Board.png" width="1000">

***

Размеры и тип компонентов:
- U3 - Плата Wt32-Eth01 [Ali](https://aliexpress.ru/item/1005002332884115.html),[ChipDip]
- R - резисторы. Все резисторы номиналом 10к, в размере 0805. Для колодки P6 в случае надобности номинал расчитываеться отдельно. [Ali](https://aliexpress.ru/item/4000095368506.html),[ChipDip]
- DC - Уже готовый модуль DC-DC Mini560 [Ali](https://aliexpress.ru/item/1005001837049300.html),[ChipDip]
- U1 - Самовостанавливающийся предохранитель MF-MSMF110-2 на 1.1а [Ali](https://aliexpress.ru/item/32975361540.html),[ChipDip]
- I2c-Shield Гребенка на 5 пинов, 2.54 [Ali](https://aliexpress.ru/item/32519474531.html?&sku_id=57443157216),[ChipDip]
- GPIO-Shield Гребенка на 6 пинов, 2.54 [Ali](https://aliexpress.ru/item/32519474531.html?&sku_id=57443157216),[ChipDip]
- J - Гребенка на 2 пина 2.54, с перемычкой [Ali](https://aliexpress.ru/item/32519474531.html?&sku_id=57443157216),[ChipDip]
- P1, P2 - Винтовые зажимы на 3 пина, 5.0 [Ali](https://aliexpress.ru/item/32861603911.html),[ChipDip]
- P3, P4, P5 - Винтовые зажимы на 3 пина, 2.54 [Ali](https://aliexpress.ru/item/1005001711075410.html), Можно объединить в 1 - 9pin [Ali](https://aliexpress.ru/item/1005001711075410.html)
- P6 - Винтовой зажим на 2 пина, 2.54 [Ali](https://aliexpress.ru/item/1005001711075410.html),[ChipDip]
- I2c - Либо Г образная гребенка на 4 пина, либо 2 виннтовых зажима, 2.54 [Ali](https://aliexpress.ru/item/32519474531.html?&sku_id=57443157216),[ChipDip]
- K - Резистор 1к, размерность 0805 [Ali](https://aliexpress.ru/item/4000095368506.html),[ChipDip]
- LINK - Светодиод в в размре 1206 [Ali](https://aliexpress.ru/item/32985163457.html),[ChipDip]
__________________________
- Корпус [Ali](https://aliexpress.ru/item/4000865202905.html),[ChipDip]
- Крепежные болты [Ali](https://aliexpress.ru/item/4001025704531.html),[ChipDip]
- Рекомендуемый блок питания [Ali](),[ChipDip]

Для заказа компонентов: [Файл BOM](/MainBoard)

### Вариации при сборке:
Можно несколько упростить схему, если:
- Внешняя подтяжка не нужна? то смело отказываемся от компонентов: R и J. 
- Будете питать только от 5v? Не распаиваем DC-DC
- Уверены в блоке питания на 5v? Смело убираем предохранитель и вместо U1 паяем перемычку. 
- Не нужен светодиод, или планируете подключать плату по wifi: не распаиваем K и LINK
- Не планируем ставить шилды - не паяем гребенку I2c-Shield и GPIO-Shield

То есть фактически, можно просто припаять клемники и плату с есп :)

***

### Прошивка EspHome
В принципе, для просто снятия показаний, и управления реле\мосфетами - можно использовать любые прошивки имеющие совместимость с esp32. Такие как Tasmot, EspEasy, Espurna, которые настриаваються в веб интерфейсе. Но. 
Но именно EspHome дает возможность, без умения программировать в среде арудино, написать внутренюю логику и взаимодействия между компонентами системы. Чем то это похоже на создание автоматизаций для Home-assistant но разумееться со своей спецификой. 
И именно EspHome имеет лучшую поддержку Home-Assistant по собственным API. Хотя при желании можно воспользоваться mqtt, и собственно подключить к любой системе УД, умеющей работать с брокером. 

Примеры конфигурационных файлов под эту плату ниже: 
- [YAML](/MainBoard/Esphome.yaml)
- Два

### Сборка платы
Схема простая, но при пайке, у новичков могут быть сложности из-за использования smd компонентов в размерности 0805 и плотности их расположения. Рекомендаия одна - желательно иметь не дрожащие руки, и паяльник с тонким ждалом)

Для удобство паяеться сначала вся мелочь. А гребенки и клемы - в самом конце. 


